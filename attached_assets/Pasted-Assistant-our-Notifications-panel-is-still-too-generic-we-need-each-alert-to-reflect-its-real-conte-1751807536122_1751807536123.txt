Assistant, our Notifications panel is still too genericâ€”we need each alert to reflect its real context (low stock, sale completed, payment received, sync error, etc.) and the Notifications **page** (the full view at `/notifications`) should show the same detailed items with clear icons, titles, and timestamps. Please update endâ€‘toâ€‘end so:

---

## 1. Notification Schema & Insertion

- **Table**: `notifications` already has `type`, `title`, `message`, `is_read`, `created_at`, `payload` (JSON).  
- **Populate** `payload` with context details when inserting:
  - **Low Stock**: `{ productId, productName, currentQty, threshold }`  
  - **Sale Completed**: `{ saleId, customerName, amount }`  
  - **Payment Received**: `{ saleId, method, amount }`  
  - **Sync Error**: `{ errorDetail }`  

Ensure all your serverâ€‘side or Edge Functions use this enriched payload.

---

## 2. TopBar Dropdown

- **Render** each notification with:
  - **Icon** based on `type` (âš ï¸ lowâ€‘stock, âœ… sale, ğŸ’° payment, âš™ï¸ sync).  
  - **Title** = `title` field.  
  - **Message** = `message` or derived from `payload`.  
  - **Time** = relative (e.g. â€œ5â€¯min agoâ€).  

Drop the generic â€œRealâ€‘time Test Notificationâ€ and instead show real data when you trigger through the tester or actual events.

---

## 3. Full Notifications Page at `/notifications`

- **List** all notifications in reverse chronological order, same styling as dropdown but fullâ€‘width.  
- **Columns** (desktop table) / **Cards** (mobile):
  - Icon  
  - Title  
  - Message / details  
  - Timestamp  
  - â€œViewâ€ link/button that navigates to the relevant page:
    - Lowâ€‘Stock â†’ `/inventory?highlight=â€¦`  
    - Sale â†’ `/sales?invoice=â€¦`  
    - Payment â†’ `/sales?invoice=â€¦#payments`  
    - Sync â†’ `/settings#sync-errors`  

---

## 4. Autoâ€‘Mark Read Behavior

- When a user **expands** the dropdown or **visits** `/notifications`, mark all unread as read in Supabase and update the badge.

---

## 5. Files to Update

- **Serverâ€‘side/Edge Functions**: enrich payload on insert  
- **hooks/useNotifications.js**: ensure you read `payload` and pass it through to the UI  
- **components/NotificationsDropdown.jsx**  
- **pages/NotificationsPage.jsx**  

---

### QA Checklist

- [ ] Trigger a lowâ€‘stock alert: see â€œLow Stock: Sukari (Qtyâ€¯3 vs thresholdâ€¯5)â€ in both dropdown and page.  
- [ ] Complete a sale: see â€œSale Completed: KESâ€¯500 to John Doeâ€ with a checkâ€‘icon.  
- [ ] Record a payment: see â€œPayment Received: KESâ€¯720 via Mâ€‘Pesaâ€ with a moneyâ€‘icon.  
- [ ] Force a sync error: see â€œSync Error: Network timeoutâ€ with gearâ€‘icon.  
- [ ] Opening dropdown or `/notifications` marks all as read.  
- [ ] â€œViewâ€ links navigate exactly to the related context page.

Implement these changes so notifications are specific, actionable, and truly reflective of real events.```







Ask ChatGPT
